namespace ConsoleCalculator
{
    class Program
    {
        static void Main(string[] args)
        {
            double num1, num2, result;
            string operation;

            while (true)
            {
                Console.WriteLine("Введите первое число:");
                string input = Console.ReadLine();
                if (input.ToLower() == "выход")
                    break;

                if (!double.TryParse(input, out num1))
                {
                    Console.WriteLine("Ошибка: Некорректный ввод числа.");
                    continue;
                }

                Console.WriteLine("Введите операцию (+, -, *, /, ^, log, !):");
                operation = Console.ReadLine();

                if (operation == "!")
                {
                    result = Factorial(num1);
                    Console.WriteLine($"Результат: {result}");
                    continue;
                }

                Console.WriteLine("Введите второе число:");
                if (!double.TryParse(Console.ReadLine(), out num2))
                {
                    Console.WriteLine("Ошибка: Некорректный ввод числа.");
                    continue;
                }

                switch (operation)
                {
                    case "+":
                        result = Add(num1, num2);
                        break;
                    case "-":
                        result = Subtract(num1, num2);
                        break;
                    case "*":
                        result = Multiply(num1, num2);
                        break;
                    case "/":
                        if (num2 == 0)
                        {
                            Console.WriteLine("Ошибка: Деление на ноль!");
                            continue;
                        }
                        result = Divide(num1, num2);
                        break;
                    case "^":
                        result = Power(num1, num2);
                        break;
                    case "log":
                        if (num1 <= 0 || num2 <= 0)
                        {
                            Console.WriteLine("Ошибка: Основание и аргумент логарифма должны быть положительными.");
                            continue;
                        }
                        result = Logarithm(num1, num2);
                        break;

                    default:
                        Console.WriteLine("Ошибка: Неизвестная операция.");
                        continue;
                }

                Console.WriteLine($"Результат: {result}");
            }

            Console.WriteLine("Программа завершена.");
        }

        
        static double Add(double a, double b) => a + b;

        static double Subtract(double a, double b) => a - b;

        static double Multiply(double a, double b) => a * b;

        static double Divide(double a, double b) => a / b;

        static double Power(double a, double b) => Math.Pow(a, b);

        static double Logarithm(double baseNum, double arg) => Math.Log(arg) / Math.Log(baseNum);

        static double Factorial(double n)
        {
            if (n < 0)
            {
                Console.WriteLine("Ошибка: Факториал определен только для неотрицательных чисел.");
               
            }

            if (n == 0)
                return 1;

            double result = 1;
            for (int i = 1; i <= n; i++)
            {
                result *= i;
            }
            return result;
        }
    }
}
